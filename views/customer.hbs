<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Dashboard - Stock Prediction System</title>
    <meta name="description" content="A final project for web application 568.">
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="/assets/css/Footer-Clean.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.1.1/aos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css">
    <link rel="stylesheet" href="/assets/css/Login-Form-Clean.css">
    <link rel="stylesheet" href="/assets/css/Registration-Form-with-Photo.css">
    <link rel="stylesheet" href="/assets/css/sidebar-1.css">
    <link rel="stylesheet" href="/assets/css/sidebar.css">
</head>

<body id="page-top" style="background-color: rgb(69,64,64);">
    <nav class="navbar navbar-light navbar-expand-lg fixed-top" id="mainNav" style="background-color: rgb(69,64,64);">
        <div class="container"><a class="navbar-brand js-scroll-trigger" href="/">Stock Prediction System</a><button class="navbar-toggler navbar-toggler-right" data-toggle="collapse" data-target="#navbarResponsive" type="button" aria-controls="navbarResponsive" aria-expanded="false"
                aria-label="Toggle navigation"><i class="fa fa-align-justify"></i></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="nav navbar-nav ml-auto">
                    <li class="nav-item dropdown">
                        <a class="dropdown-toggle nav-link" data-toggle="dropdown" aria-expanded="false" href="#">Welcome, {{ username }}</a>
                        <div class="dropdown-menu" role="menu">
                            <a class="dropdown-item" role="presentation" href="/dashboard">Dashboard</a>
                            <a class="dropdown-item" role="presentation" href="/users/logout">Logout</a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div style="background-color: #ffffff;">
        <div class="container cur_section">
            <div class="row">
                <div class="col">
                    <div>
                        <ul class="nav nav-tabs">
                            <li class="nav-item"><a class="nav-link active" role="tab" data-toggle="tab" href="#tab-1">Overview</a></li>
                            <li class="nav-item"><a class="nav-link" role="tab" data-toggle="tab" href="#tab-2">Favorite List</a></li>
                            <li class="nav-item"><a class="nav-link" role="tab" data-toggle="tab" href="#tab-3">Profile</a></li>
                        </ul>
                        <div class="tab-content" style="padding-top: 20px;">
                            <div class="tab-pane active" role="tabpanel" id="tab-1">
                                <div class="table-responsive" id="dashboard_table">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Stock Symbols</th>
                                                <th>Current Price</th>
                                                <th>Estimated Price (Tomorrow)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Cell 1</td>
                                                <td>Cell 2</td>
                                                <td>Cell 3</td>
                                            </tr>
                                            <tr>
                                                <td>Cell 3</td>
                                                <td>Cell 4</td>
                                                <td>Cell 3</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>



                            <div class="tab-pane" role="tabpanel" id="tab-2">
                                <div class="table-responsive" id="favorite_table">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Symbol</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Cell 1</td>
                                                <td>Cell 2</td>
                                            </tr>
                                            <tr>
                                                <td>Cell 3</td>
                                                <td>Cell 4</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div>
                                    
                                        <label>Symbol Name:</label>
                                        <select id="search_symbol">
                                          <option value="volvo">Volvo</option>
                                          <option value="saab">Saab</option>
                                          <option value="mercedes">Mercedes</option>
                                          <option value="audi">Audi</option>
                                        </select>
                                        <button type="button" name="submit" class='btn btn-success' onclick="subscribe_symbol()">Subscribe</button>
                                    
                                </div>
                            </div>
                            <div class="tab-pane" role="tabpanel" id="tab-3">
                                <form method='POST'>
                                    <label>Current Password:</label><input class="form-control" type="password" name="cur_password" required="">
                                    <label>New Password:</label><input class="form-control" type="password" name="new_password" required="">
                                    <label>Confirm New Password:</label><input class="form-control" type="password" name="new_password_confirm" required="">
                                    <div style="padding-top: 10px">
                                        <button class="btn btn-success" type="submit">submit</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer-clean">
        <footer>
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-sm-4 col-md-3 item">
                        <h3>Services</h3>
                        <ul>
                            <li><a href="#">Web design</a></li>
                            <li><a href="#">Development</a></li>
                            <li><a href="#">Hosting</a></li>
                        </ul>
                    </div>
                    <div class="col-sm-4 col-md-3 item">
                        <h3>About</h3>
                        <ul>
                            <li><a href="#">Company</a></li>
                            <li><a href="#">Team</a></li>
                            <li><a href="#">Legacy</a></li>
                        </ul>
                    </div>
                    <div class="col-sm-4 col-md-3 item">
                        <h3>Careers</h3>
                        <ul>
                            <li><a href="#">Job openings</a></li>
                            <li><a href="#">Employee success</a></li>
                            <li><a href="#">Benefits</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-3 item social"><a href="#"><i class="icon ion-social-facebook"></i></a><a href="#"><i class="icon ion-social-twitter"></i></a><a href="#"><i class="icon ion-social-snapchat"></i></a><a href="#"><i class="icon ion-social-instagram"></i></a>
                        <p class="copyright">Stock Prediction System, Team #7 Â© 2019</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
    <script src="/assets/js/creative.js"></script>
    <script src="/assets/js/bs-animation.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.1.1/aos.js"></script>
    <script type="text/javascript" src="/javascripts/api.js"></script>
    <script type="text/javascript">
        function makeTable(container, data) {
            container.html('');
            var table = $("<table/>").addClass('table');
            $.each(data, function(rowIndex, r) {
                var row = $("<tr/>");
                $.each(r, function(colIndex, c) {
                    row.append($("<t" + (rowIndex == 0 ? "h" : "d") + "/>").html(c));
                });
                table.append(row);
            });
            return container.append(table);
        }

        function refresh_tables(){
            get_userprofile(function(result){

                filltable(result.interests);

            });

            $('#search_symbol').html('');
            function add_option(value) {
                return '<option value=\"{0}\">{0}</option>'.format(value);
            }

            obtain_symbol_list(function(result){
                options = ''
                for(var i = 0; i < result.length; i ++) {
                    options += add_option(result[i]);
                }
                $('#search_symbol').html(options);
            });
        }

        function unsubscribe_symbol(symbol) {
            favorite_list_remove(symbol, function(result){
                refresh_tables();
            });
        }

        function subscribe_symbol() {
            var symbol = $('#search_symbol').val();
            favorite_list_add(symbol, function(result){
                refresh_tables();
            });
        }

        function filltable(symbols) {

            function symbol_url(symbol) {return '/stockdetail/{0}'.format(symbol); }
            function make_ahref(href, name) {return "<a href='{0}'><u>{1}</u></a>".format(href, name); }
            function make_div(id){return "<div id='{0}'>pending</div>".format(id);}

            var dashboard_table_data = [['Symbol', 'Current Price', 'Estimated Price (Tomorrow)']];
            var favorite_table_data = [['Symbol', 'Action']];

            for (var i = 0; i < symbols.length; i++) {
                var symbol = symbols[i];

                dashboard_table_data.push([make_ahref(symbol_url(symbol), symbol), make_div('cur_{0}'.format(symbol)), make_div('pred_{0}'.format(symbol))]);
                favorite_table_data.push([make_ahref(symbol_url(symbol), symbol), '<button class="btn btn-warning" onclick="javascript:unsubscribe_symbol(\'{0}\')">Unsubscribe</button>'.format(symbol)])

                get_newest_stock(symbol, function(result){
                    $('#cur_' + result.symbol).text(result.open);
                });

                get_stock_prediction(symbol, function(result){
                    var avg = (result.LSTM + result.SVR + result.BCF) / 3;
                    $('#pred_' + result.symbol).text(avg);
                    
                });
            }

            makeTable($("#dashboard_table"), dashboard_table_data);
            makeTable($("#favorite_table"), favorite_table_data);

        }

        

        $(window).on('load', function(){
            refresh_tables();
        });
    </script>
</body>

</html>